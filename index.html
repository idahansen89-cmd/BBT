<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>BBT & LH</title>
<link rel="icon" type="image/png" href="B29437FC-696F-4754-AAAB-A6ED096BC64C.png" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1"></script>
<style>
:root{
  --pink:#f4b6c2; --pink-hover:#e599ab; --text:#333; --line:#eee;
}
*{box-sizing:border-box;}
body{font-family:"Helvetica Neue",Arial,sans-serif;background:#fff;color:var(--text);margin:0;padding:0;}
h1{text-align:center;margin:1rem 0;}
.tabs{display:flex;justify-content:center;gap:.4rem;border-bottom:2px solid #ddd;padding-bottom:.4rem;}
.tab{padding:.7rem 1.2rem;border:none;border-radius:8px 8px 0 0;background:#f4f4f4;font-weight:600;cursor:pointer;}
.tab.active{background:#fff;border-bottom:2px solid #fff;color:#e06b8f;}
.tab-content{display:none;max-width:820px;margin:1rem auto;padding:1rem;border:1px solid var(--line);border-radius:12px;background:#fff;}
.tab-content.active{display:block;}
.form-row{display:flex;align-items:center;gap:.6rem;margin-bottom:.6rem;}
.form-row label{width:160px;font-weight:600;}
.form-row input,.form-row select,.form-row textarea{flex:1;padding:.45rem .6rem;border:1px solid #ccc;border-radius:8px;font-size:.95rem;}
textarea{resize:vertical;min-height:56px;}
.inline-symbols{display:flex;align-items:center;gap:1rem;margin:.4rem 0 .6rem;}
.inline-symbols .symbol{display:inline-flex;align-items:center;gap:.4rem;font-size:1.15rem;}
.button{background:var(--pink);color:#222;border:none;border-radius:8px;padding:.55rem 1.1rem;font-weight:700;cursor:pointer;}
.button:hover{background:var(--pink-hover);}
.table-wrap{overflow-x:auto;margin-top:1rem;}
table{width:100%;border-collapse:collapse;}
th,td{padding:.55rem;border:1px solid #ddd;text-align:center;}
tr.mens-row{background:#ffe5ec;}
.top-buttons{display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.3rem;margin-bottom:.4rem;}
.chart-toolbar{display:flex;justify-content:center;margin-top:.75rem;}
.lh-toolbar{display:flex;align-items:center;justify-content:space-between;gap:.6rem;flex-wrap:wrap;}
.lh-symbols-row{display:flex;align-items:center;flex-wrap:wrap;gap:.8rem;margin:.6rem 0;}
.lh-spacer{flex:1 1 auto;}
.lh-timepair{display:flex;align-items:center;gap:.8rem;margin-left:auto;}
.lh-symbol-checkbox{display:inline-block;text-align:center;font-size:1.3rem;line-height:1.2;}
.lh-symbol-checkbox small{display:block;color:#777;font-size:.75rem;margin-top:.15rem;}
.lh-row{display:flex;align-items:flex-start;justify-content:space-between;gap:.6rem;padding:.5rem 0;border-bottom:1px solid #eee;}
.lh-img{width:100%;max-height:120px;object-fit:contain;border-radius:8px;background:#fff;}
.lh-info{flex:1;}
</style>
</head>
<body>
<h1>BBT & LH</h1>

<div class="tabs">
  <button class="tab active" data-tab="inmatning">Inmatning & Tabell</button>
  <button class="tab" data-tab="graf">ğŸ“ˆ Graf</button>
  <button class="tab" data-tab="lh">ğŸ§ª LH-test</button>
</div>

<!-- LH-test -->
<div id="lh" class="tab-content active">
  <div class="lh-toolbar">
    <div style="display:flex; gap:.5rem; align-items:center">
      <button class="button" id="lhPickBtn">VÃ¤lj bild</button>
      <input type="file" id="lhFile" accept="image/*" style="display:none">
    </div>
    <input type="date" id="lhDate">
  </div>

  <div class="lh-symbols-row">
    <label class="lh-symbol-checkbox" title="NÃ¤stan positiv">ğŸ©·<small>N</small><br><input type="checkbox" class="lhSym" value="ğŸ©·"></label>
    <label class="lh-symbol-checkbox" title="LH-topp">â¤ï¸<small>T</small><br><input type="checkbox" class="lhSym" value="â¤ï¸"></label>
    <label class="lh-symbol-checkbox" title="HÃ¶g">ğŸ’œ<small>H</small><br><input type="checkbox" class="lhSym" value="ğŸ’œ"></label>
    <label class="lh-symbol-checkbox" title="LÃ¥g">ğŸ’™<small>L</small><br><input type="checkbox" class="lhSym" value="ğŸ’™"></label>
    <label class="lh-symbol-checkbox" title="Negativ">ğŸ’š<small>â€“</small><br><input type="checkbox" class="lhSym" value="ğŸ’š"></label>
    <label class="lh-symbol-checkbox" title="Oklart">ğŸ’›<small>?</small><br><input type="checkbox" class="lhSym" value="ğŸ’›"></label>

    <span class="lh-spacer"></span>
    <div class="lh-timepair">
      <label class="lh-symbol-checkbox" title="FÃ¶rmiddag">â˜€ï¸<small>FM</small><br><input type="checkbox" id="lhAM"></label>
      <label class="lh-symbol-checkbox" title="KvÃ¤ll">ğŸŒ™<small>EM</small><br><input type="checkbox" id="lhPM"></label>
    </div>
  </div>

  <div style="display:flex; gap:.5rem; align-items:center; margin-bottom:.5rem">
    <textarea id="lhNote" placeholder="Anteckning (valfritt)" style="flex:1"></textarea>
    <button class="button" id="lhSaveBtn">Spara</button>
  </div>

  <div id="lhList"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded',()=>{
  /* === Elements === */
  const el={
    lhPickBtn:document.getElementById('lhPickBtn'),
    lhFile:document.getElementById('lhFile'),
    lhDate:document.getElementById('lhDate'),
    lhNote:document.getElementById('lhNote'),
    lhSaveBtn:document.getElementById('lhSaveBtn'),
    lhList:document.getElementById('lhList'),
    lhSymChecks:()=>Array.from(document.querySelectorAll('.lhSym:checked')),
    lhAM:document.getElementById('lhAM'),
    lhPM:document.getElementById('lhPM')
  };
  let lhEntries=JSON.parse(localStorage.getItem('lhData')||'[]');

  /* === Flikar === */
  document.querySelectorAll('.tab').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const id=btn.dataset.tab;
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById(id).classList.add('active');
      if(id==='lh') renderLHList();
    });
  });

  /* === Bildval === */
  el.lhPickBtn.addEventListener('click',()=>{
    el.lhFile.dispatchEvent(new MouseEvent('click',{bubbles:true}));
  });

  /* === FÃ¶rhandsvisning === */
  function updateLHPreview(){
    let wrap=document.getElementById('lhPreviewWrap');
    if(wrap)wrap.remove();
    const file=el.lhFile.files&&el.lhFile.files[0];
    if(!file)return;
    const r=new FileReader();
    r.onload=ev=>{
      wrap=document.createElement('div');
      wrap.id='lhPreviewWrap';
      wrap.style='display:flex;align-items:center;gap:.5rem;margin:.4rem 0;';
      const img=document.createElement('img');
      img.src=ev.target.result;
      img.style='width:70px;height:50px;object-fit:cover;border-radius:6px;';
      const info=document.createElement('div');
      info.id='lhPreviewInfo';
      info.style='font-size:.8rem;color:#444;';
      wrap.appendChild(img);
      wrap.appendChild(info);
      document.querySelector('.lh-toolbar').after(wrap);
      refreshPreviewInfo();
    };
    r.readAsDataURL(file);
  }

  function refreshPreviewInfo(){
    const info=document.getElementById('lhPreviewInfo');
    if(!info)return;
    const date=el.lhDate.value||'(Datum ej valt)';
    const syms=el.lhSymChecks().map(x=>x.value).join(' ')||'â€“';
    const note=el.lhNote.value?`"${el.lhNote.value}"`:'';
    info.innerHTML=`<div><strong>${date}</strong></div><div style="font-size:1rem;margin:.1rem 0;">${syms}</div><div>${note}</div>`;
  }

  el.lhFile.addEventListener('change',updateLHPreview);
  ['change','input'].forEach(e=>{
    el.lhDate.addEventListener(e,refreshPreviewInfo);
    el.lhNote.addEventListener(e,refreshPreviewInfo);
  });
  document.querySelectorAll('.lhSym').forEach(cb=>cb.addEventListener('change',refreshPreviewInfo));

  /* === Spara bild === */
  el.lhSaveBtn.addEventListener('click',()=>{
    const file=el.lhFile.files&&el.lhFile.files[0];
    if(!file){alert('ğŸ“¸ VÃ¤lj en bild fÃ¶rst.');return;}
    if(!el.lhDate.value){alert('ğŸ“… VÃ¤lj datum.');return;}
    const r=new FileReader();
    r.onload=e=>{
      const dataUrl=e.target.result;
      const symbols=el.lhSymChecks().map(x=>x.value);
      const note=el.lhNote.value||'';
      const am=el.lhAM.checked;
      const pm=el.lhPM.checked;
      lhEntries.push({date:el.lhDate.value,symbols,note,am,pm,dataUrl});
      localStorage.setItem('lhData',JSON.stringify(lhEntries));
      renderLHList();
      el.lhNote.value='';el.lhFile.value='';el.lhAM.checked=false;el.lhPM.checked=false;
      document.querySelectorAll('.lhSym').forEach(cb=>cb.checked=false);
      const prev=document.getElementById('lhPreviewWrap');if(prev)prev.remove();
      alert('âœ… Bilden har sparats!');
    };
    r.onerror=err=>{console.error(err);alert('ğŸš« Kunde inte lÃ¤sa in bilden.');};
    r.readAsDataURL(file);
  });

  /* === Rendera lista === */
  function renderLHList(){
    el.lhList.innerHTML='';
    lhEntries.sort((a,b)=>a.date.localeCompare(b.date));
    lhEntries.forEach((e,i)=>{
      const row=document.createElement('div');
      row.className='lh-row';
      row.innerHTML=`
        <div style="flex:0 0 38%">
          <img class="lh-img" src="${e.dataUrl}" alt="LH-bild">
        </div>
        <div class="lh-info">
          <div style="font-weight:700">${e.date||''} ${e.am?'â˜€ï¸':''} ${e.pm?'ğŸŒ™':''}</div>
          <div style="font-size:1.15rem;margin:.15rem 0;">${(e.symbols||[]).join(' ')}</div>
          <div style="font-size:.9rem;color:#555">${e.note||''}</div>
        </div>
        <div><button class="button danger" data-del="${i}">Ta bort</button></div>`;
      row.querySelector('[data-del]').addEventListener('click',()=>{
        lhEntries.splice(i,1);
        localStorage.setItem('lhData',JSON.stringify(lhEntries));
        renderLHList();
      });
      el.lhList.appendChild(row);
    });
  }

  renderLHList();
});
</script>
</body>
</html>